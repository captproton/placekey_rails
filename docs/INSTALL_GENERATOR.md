# PlacekeyRails Install Generator

The PlacekeyRails gem includes a powerful install generator that automates the setup process. This guide explains how to use the generator and its available options.

## Basic Usage

After adding the gem to your Gemfile and running `bundle install`, you can use the generator to quickly set up the gem:

```bash
rails generate placekey_rails:install
```

This command will:

1. Create an initializer at `config/initializers/placekey_rails.rb`
2. Create a migration to add a `placekey` column to a `location` model (or create the model if it doesn't exist)
3. Update the model to include the `Placekeyable` concern
4. Set up JavaScript integration

After running the generator, don't forget to apply the migration:

```bash
rails db:migrate
```

## Generator Options

The generator accepts several options to customize the installation:

### `--api_key=KEY`

Specify your Placekey API key to automatically configure the gem with it:

```bash
rails generate placekey_rails:install --api_key=your_api_key_here
```

This will create an initializer with your API key already configured:

```ruby
# config/initializers/placekey_rails.rb
PlacekeyRails.setup_client("your_api_key_here")
```

### `--model=NAME`

Specify a different model name (default is 'location'):

```bash
rails generate placekey_rails:install --model=venue
```

This will:
- Create or update a `Venue` model
- Create a migration for the `venues` table
- Add the `Placekeyable` concern to the `Venue` model

### `--skip_initializer`

Skip creating the initializer file:

```bash
rails generate placekey_rails:install --skip_initializer
```

Use this if you want to configure the gem manually or already have an initializer.

### `--skip_migration`

Skip creating the migration file:

```bash
rails generate placekey_rails:install --skip_migration
```

Use this if you already have a `placekey` column in your model or want to add it manually.

### `--skip_model`

Skip modifying the model file:

```bash
rails generate placekey_rails:install --skip_model
```

Use this if you want to manually add the `Placekeyable` concern to your model.

### `--skip_javascript`

Skip setting up JavaScript integration:

```bash
rails generate placekey_rails:install --skip_javascript
```

Use this if you don't need the JavaScript components or want to set them up manually.

## Examples

### Minimal Setup (API Only)

If you only need the API functionality without ActiveRecord integration:

```bash
rails generate placekey_rails:install --skip_model --skip_migration --api_key=your_api_key
```

### Custom Model with Full Setup

Set up PlacekeyRails with a custom model and API key:

```bash
rails generate placekey_rails:install --model=store --api_key=your_api_key
```

### Multiple Models

You can run the generator multiple times with different model names:

```bash
rails generate placekey_rails:install --model=venue
rails generate placekey_rails:install --model=event --skip_initializer
rails generate placekey_rails:install --model=attraction --skip_initializer
```

## Generated Files

### Initializer

The generator creates an initializer with recommended configuration:

```ruby
# config/initializers/placekey_rails.rb
# PlacekeyRails Configuration
# Generated by PlacekeyRails install generator

# Set up the API client with your Placekey API key
PlacekeyRails.setup_client("your_api_key")
# You can get an API key from https://placekey.io

# Enable caching to improve performance (recommended)
PlacekeyRails.enable_caching(max_size: 1000)

# Configure other options
PlacekeyRails.configure do |config|
  # Default country code for address lookups
  config[:default_country_code] = "US"
  
  # Validate placekeys on assignment (recommended)
  config[:validate_placekeys] = true
  
  # API request timeout in seconds
  config[:api_timeout] = 10
  
  # Whether to raise exceptions on API errors
  config[:raise_on_api_error] = false
end
```

### Migration

For an existing model:

```ruby
class AddPlacekeyToLocations < ActiveRecord::Migration[7.0]
  def change
    add_column :locations, :placekey, :string
    add_index :locations, :placekey
  end
end
```

For a new model:

```ruby
class CreateLocations < ActiveRecord::Migration[7.0]
  def change
    create_table :locations do |t|
      t.string :name
      t.text :description
      t.string :street_address
      t.string :city
      t.string :region
      t.string :postal_code
      t.string :iso_country_code
      t.float :latitude
      t.float :longitude
      t.string :placekey
      t.boolean :featured, default: false

      t.timestamps
    end
    
    add_index :locations, :placekey
    add_index :locations, [:latitude, :longitude]
  end
end
```

### Model

For a new model:

```ruby
class Location < ApplicationRecord
  include PlacekeyRails::Concerns::Placekeyable
  
  validates :name, presence: true
  
  # Additional code with examples...
end
```

For an existing model, it adds the concern:

```ruby
include PlacekeyRails::Concerns::Placekeable
```

### JavaScript Integration

The generator adds the import to your JavaScript entry point:

```javascript
// Import PlacekeyRails JavaScript components
import "placekey_rails"
```

## Troubleshooting

### The generator can't find my model

Make sure your model exists in `app/models/your_model_name.rb`. If it doesn't, the generator will create it for you.

### The migration doesn't apply correctly

If you get an error when running `rails db:migrate`, check if:
- The table already exists
- The `placekey` column already exists
- The database user has permission to modify the table

### JavaScript components aren't working

Make sure your application is properly configured to use JavaScript:
- For Rails 7+, check that you have jsbundling-rails or importmaps-rails set up
- For Rails 6, make sure Webpacker is properly configured
- Verify that the import is in your JavaScript entry point

## Next Steps

After running the generator:

1. Run migrations with `rails db:migrate`
2. Explore the PlacekeyRails API in the [API Reference](API_REFERENCE.md)
3. Learn about ActiveRecord integration in [ActiveRecord Integration](ACTIVERECORD_INTEGRATION.md)
